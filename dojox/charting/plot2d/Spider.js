//>>built
define("dojox/charting/plot2d/Spider","dojo/_base/lang dojo/_base/declare dojo/_base/connect dojo/_base/array dojo/dom-geometry dojo/_base/fx dojo/fx dojo/sniff ./Base ./_PlotEvents ./common ../axis2d/common dojox/gfx dojox/gfx/matrix dojox/gfx/fx dojox/lang/functional dojox/lang/utils dojo/fx/easing".split(" "),function(I,V,J,K,P,L,W,Q,X,Y,R,S,B,Z,ba,T,U,$){return V("dojox.charting.plot2d.Spider",[X,Y],{defaultParams:{labels:!0,ticks:!1,fixed:!0,precision:1,labelOffset:-10,labelStyle:"default",htmlLabels:!0,
startAngle:-90,divisions:3,axisColor:"",axisWidth:0,spiderColor:"",spiderWidth:0,seriesWidth:0,seriesFillAlpha:0.2,spiderOrigin:0.16,markerSize:3,spiderType:"polygon",animationType:$.backOut,axisTickFont:"",axisTickFontColor:"",axisFont:"",axisFontColor:""},optionalParams:{radius:0,font:"",fontColor:""},constructor:function(a,e){this.opt=I.clone(this.defaultParams);U.updateWithObject(this.opt,e);U.updateWithPattern(this.opt,e,this.optionalParams);this.dyn=[];this.datas={};this.labelKey=[];this.oldSeriePoints=
{};this.animations={}},clear:function(){this.inherited(arguments);this.dyn=[];this.axes=[];this.datas={};this.labelKey=[];this.oldSeriePoints={};this.animations={};return this},setAxis:function(a){a&&(void 0!=a.opt.min&&(this.datas[a.name].min=a.opt.min),void 0!=a.opt.max&&(this.datas[a.name].max=a.opt.max));return this},addSeries:function(a){this.series.push(a);for(var e in a.data){var d=a.data[e],h=this.datas[e];h?(h.vlist.push(d),h.min=Math.min(h.min,d),h.max=Math.max(h.max,d)):(h="__"+e,this.axes.push(h),
this[h]=e,this.datas[e]={min:d,max:d,vlist:[d]})}if(0>=this.labelKey.length)for(e in a.data)this.labelKey.push(e);return this},getSeriesStats:function(){return R.collectSimpleStats(this.series)},render:function(a,e){if(!this.dirty)return this;this.dirty=!1;this.cleanGroup();var d=this.group,h=this.chart.theme;this.resetEvents();if(!this.series||!this.series.length)return this;var b=this.opt,f=h.axis,c=(a.width-e.l-e.r)/2,k=(a.height-e.t-e.b)/2,l=Math.min(c,k),s=b.font||f.majorTick&&f.majorTick.font||
f.tick&&f.tick.font||"normal normal normal 7pt Tahoma",q=b.axisFont||f.tick&&f.tick.titleFont||"normal normal normal 11pt Tahoma",v=b.axisTickFontColor||f.majorTick&&f.majorTick.fontColor||f.tick&&f.tick.fontColor||"silver",E=b.axisFontColor||f.tick&&f.tick.titleFontColor||"black",x=b.axisColor||f.tick&&f.tick.axisColor||"silver",m=b.spiderColor||f.tick&&f.tick.spiderColor||"silver",aa=b.axisWidth||f.stroke&&f.stroke.width||2,y=b.spiderWidth||f.stroke&&f.stroke.width||2,f=b.seriesWidth||f.stroke&&
f.stroke.width||2,r=B.normalizedLength(B.splitFontString(q).size),D=Z._degToRad(b.startAngle),N,t,M,u,p,z,w=b.spiderOrigin,C=3<=b.divisions?b.divisions:3,I=b.markerSize,J=b.spiderType,L=b.animationType,g=-10>b.labelOffset?b.labelOffset:-10,n;b.labels&&(l=K.map(this.series,function(a){return a.name},this),l=T.foldl1(T.map(l,function(a){return B._base._getTextBox(a,{font:h.series.font}).w},this),"Math.max(a, b)")/2,l=Math.min(c-2*l,k-r)+g,N=l-g);"radius"in b&&(l=b.radius,N=l-g);l/=1.2;c={cx:e.l+c,cy:e.t+
k,r:l};for(k=this.series.length-1;0<=k;k--)if(n=this.series[k],!this.dirty&&!n.dirty)h.skip();else if(n.cleanGroup(),g=n.data,null!==g&&(r=this._getObjectLength(g),!t||0>=t.length))if(t=[],M=[],z=[],this._buildPoints(t,r,c,l,D,!0,a),this._buildPoints(M,r,c,l*w,D,!0,a),this._buildPoints(z,r,c,N,D,!1,a),2<C){u=[];p=[];for(g=0;g<C-2;g++)u[g]=[],this._buildPoints(u[g],r,c,l*(w+(1-w)*(g+1)/(C-1)),D,!0,a),p[g]=l*(w+(1-w)*(g+1)/(C-1))}r=d.createGroup();x={color:x,width:aa};k={color:m,width:y};for(g=t.length-
1;0<=g;--g)m=t[g],y={x:m.x+0.2*(m.x-c.cx),y:m.y+0.2*(m.y-c.cy)},m={x:m.x+0.2*(m.x-c.cx)/2,y:m.y+0.2*(m.y-c.cy)/2},r.createLine({x1:c.cx,y1:c.cy,x2:y.x,y2:y.y}).setStroke(x),this._drawArrow(r,y,m,x);r=d.createGroup();for(g=z.length-1;0<=g;--g)m=z[g],y=B._base._getTextBox(this.labelKey[g],{font:q}).w||0,x=this.opt.htmlLabels&&"vml"!=B.renderer?"html":"gfx",m=S.createText[x](this.chart,r,!P.isBodyLtr()&&"html"==x?m.x+y-a.width:m.x,m.y,"middle",this.labelKey[g],q,E),this.opt.htmlLabels&&this.htmlElements.push(m);
q=d.createGroup();if("polygon"==J){if(q.createPolyline(t).setStroke(k),q.createPolyline(M).setStroke(k),0<u.length)for(g=u.length-1;0<=g;--g)q.createPolyline(u[g]).setStroke(k)}else if(q.createCircle({cx:c.cx,cy:c.cy,r:l}).setStroke(k),q.createCircle({cx:c.cx,cy:c.cy,r:l*w}).setStroke(k),0<p.length)for(g=p.length-1;0<=g;--g)q.createCircle({cx:c.cx,cy:c.cy,r:p[g]}).setStroke(k);r=this._getObjectLength(this.datas);q=d.createGroup();u=0;for(var F in this.datas){p=this.datas[F];t=p.min;p=p.max;p-=t;E=
D+2*Math.PI*u/r;for(k=0;k<C;k++)z=t+p*k/(C-1),m=this._getCoordinate(c,l*(w+(1-w)*k/(C-1)),E,a),z=this._getLabel(z),y=B._base._getTextBox(z,{font:s}).w||0,x=this.opt.htmlLabels&&"vml"!=B.renderer?"html":"gfx",this.opt.htmlLabels&&this.htmlElements.push(S.createText[x](this.chart,q,!P.isBodyLtr()&&"html"==x?m.x+y-a.width:m.x,m.y,"start",z,s,v));u++}this.chart.seriesShapes={};for(k=this.series.length-1;0<=k;k--)if(n=this.series[k],g=n.data,null!==g){var A=[],G=[];u=0;for(F in g)p=this.datas[F],t=p.min,
p=p.max,p-=t,s=g[F],E=D+2*Math.PI*u/r,m=this._getCoordinate(c,l*(w+(1-w)*(s-t)/p),E,a),A.push(m),G.push({sname:n.name,key:F,data:s}),u++;A[A.length]=A[0];G[G.length]=G[0];var s=this._getBoundary(A),v=h.next("spider",[b,n]),O=n.group,H=B.normalizeColor(v.series.fill),v={color:v.series.fill,width:f};H.a=b.seriesFillAlpha;n.dyn={fill:H,stroke:v};v=this._createSeriesEntry(O,this.oldSeriePoints[n.name]||M,A,H,v,l,w,I,L);this.chart.seriesShapes[n.name]=v;this.oldSeriePoints[n.name]=A;this._connectEvents({element:"spider_poly",
index:k,id:"spider_poly_"+n.name,run:n,plot:this,shape:v.poly,parent:O,brect:s,cx:c.cx,cy:c.cy,cr:l,f:H,s:d});this._connectEvents({element:"spider_plot",index:k,id:"spider_plot_"+n.name,run:n,plot:this,shape:n.group});K.forEach(v.circles,function(a,b){this._connectEvents({element:"spider_circle",index:b,id:"spider_circle_"+n.name+b,run:n,plot:this,shape:a,parent:O,tdata:G[b],cx:A[b].x,cy:A[b].y,f:H,s:d})},this)}return this},_createSeriesEntry:function(a,e,d,h,b,f,c,k,l){var s=a.createPolyline(e).setFill(h).setStroke(b),
q=[];for(f=0;f<e.length;f++)c=e[f],c=a.createCircle({cx:c.x,cy:c.y,r:k}).setFill(h).setStroke(b),q.push(c);h=K.map(d,function(a,b){var c=new L.Animation({duration:1E3,easing:l,curve:[e[b].y,a.y]}),d=q[b];J.connect(c,"onAnimate",function(a){var c=s.getShape();c.points[b].y=a;s.setShape(c);c=d.getShape();c.cy=a;d.setShape(c)});return c});d=K.map(d,function(a,b){var c=new L.Animation({duration:1E3,easing:l,curve:[e[b].x,a.x]}),d=q[b];J.connect(c,"onAnimate",function(a){var c=s.getShape();c.points[b].x=
a;s.setShape(c);c=d.getShape();c.cx=a;d.setShape(c)});return c});W.combine(h.concat(d)).play();return{group:a,poly:s,circles:q}},plotEvent:function(a){"spider_plot"==a.element&&"onmouseover"==a.type&&!Q("ie")&&a.shape.moveToFront()},tooltipFunc:function(a){return"spider_circle"==a.element?a.tdata.sname+"\x3cbr/\x3e"+a.tdata.key+"\x3cbr/\x3e"+a.tdata.data:null},_getBoundary:function(a){for(var e=a[0].x,d=a[0].x,h=a[0].y,b=a[0].y,f=0;f<a.length;f++)var c=a[f],e=Math.max(c.x,e),h=Math.max(c.y,h),d=Math.min(c.x,
d),b=Math.min(c.y,b);return{x:d,y:b,width:e-d,height:h-b}},_drawArrow:function(a,e,d,h){var b=Math.sqrt(Math.pow(d.x-e.x,2)+Math.pow(d.y-e.y,2)),f=(d.y-e.y)/b,c=(d.x-e.x)/b;a.createPolyline([e,{x:d.x+b/3*-f,y:d.y+b/3*c},{x:d.x+b/3*f,y:d.y+b/3*-c}]).setFill(h.color).setStroke(h)},_buildPoints:function(a,e,d,h,b,f,c){for(var k=0;k<e;k++)a.push(this._getCoordinate(d,h,b+2*Math.PI*k/e,c));f&&a.push(this._getCoordinate(d,h,b+2*Math.PI,c))},_getCoordinate:function(a,e,d,h){var b=a.cx+e*Math.cos(d);Q("dojo-bidi")&&
(this.chart.isRightToLeft()&&h)&&(b=h.width-b);return{x:b,y:a.cy+e*Math.sin(d)}},_getObjectLength:function(a){var e=0;if(I.isObject(a))for(var d in a)e++;return e},_getLabel:function(a){return R.getLabel(a,this.opt.fixed,this.opt.precision)}})});
//@ sourceMappingURL=Spider.js.map