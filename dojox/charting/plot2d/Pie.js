//>>built
define("dojox/charting/plot2d/Pie","dojo/_base/lang dojo/_base/array dojo/_base/declare ./Base ./_PlotEvents ./common dojox/gfx dojox/gfx/matrix dojox/lang/functional dojox/lang/utils dojo/has".split(" "),function(D,r,E,H,N,O,v,K,k,F,L){return E("dojox.charting.plot2d.Pie",[H,N],{defaultParams:{labels:!0,ticks:!1,fixed:!0,precision:1,labelOffset:20,labelStyle:"default",htmlLabels:!0,radGrad:"native",fanSize:5,startAngle:0},optionalParams:{radius:0,omitLabels:!1,stroke:{},outline:{},shadow:{},fill:{},
filter:{},styleFunc:null,font:"",fontColor:"",labelWiring:{}},constructor:function(h,c){this.opt=D.clone(this.defaultParams);F.updateWithObject(this.opt,c);F.updateWithPattern(this.opt,c,this.optionalParams);this.axes=[];this.run=null;this.dyn=[]},clear:function(){this.inherited(arguments);this.dyn=[];this.run=null;return this},setAxis:function(h){return this},addSeries:function(h){this.run=h;return this},getSeriesStats:function(){return D.delegate(O.defaultStats)},getRequiredColors:function(){return this.run?
this.run.data.length:0},render:function(h,c){if(!this.dirty)return this;this.resetEvents();this.dirty=!1;this._eventSeries={};this.cleanGroup();var p=this.group,b=this.chart.theme;if(!this.run||!this.run.data.length)return this;var d=(h.width-c.l-c.r)/2,e=(h.height-c.t-c.b)/2,g=Math.min(d,e),x="font"in this.opt?this.opt.font:b.series.font,q,B=K._degToRad(this.opt.startAngle),m=B,l,t,u,C,y=this.run.data,F=this.events();this.dyn=[];"radius"in this.opt&&(g=this.opt.radius,C=g-this.opt.labelOffset);var a=
{cx:c.l+d,cy:c.t+e,r:g};if(this.opt.shadow||b.shadow){l=this.opt.shadow||b.shadow;var z=D.clone(a);z.cx+=l.dx;z.cy+=l.dy;p.createCircle(z).setFill(l.color).setStroke(l)}if(p.setFilter&&(this.opt.filter||b.filter))p.createCircle(a).setFill(b.series.stroke).setFilter(this.opt.filter||b.filter);if("number"==typeof y[0]){l=k.map(y,"x ? Math.max(x, 0) : 0");if(k.every(l,"\x3c\x3d 0"))return p.createCircle(a).setStroke(b.series.stroke),this.dyn=r.map(l,function(){return{}}),this;t=k.map(l,"/this",k.foldl(l,
"+",0));this.opt.labels&&(u=r.map(t,function(a){return 0<a?this._getLabel(100*a)+"%":""},this))}else{l=k.map(y,"x ? Math.max(x.y, 0) : 0");if(k.every(l,"\x3c\x3d 0"))return p.createCircle(a).setStroke(b.series.stroke),this.dyn=r.map(l,function(){return{}}),this;t=k.map(l,"/this",k.foldl(l,"+",0));this.opt.labels&&(u=r.map(t,function(a,c){if(0>a)return"";var b=y[c];return"text"in b?b.text:this._getLabel(100*a)+"%"},this))}var G=k.map(y,function(a,c){var n=[this.opt,this.run];null!==a&&"number"!=typeof a&&
n.push(a);this.opt.styleFunc&&n.push(this.opt.styleFunc(a));return b.next("slice",n,!0)},this);this.opt.labels&&(q=x?v.normalizedLength(v.splitFontString(x).size):0,l=k.foldl1(k.map(u,function(a,c){return v._base._getTextBox(a,{font:G[c].series.font}).w},this),"Math.max(a, b)")/2,0>this.opt.labelOffset&&(g=Math.min(d-2*l,e-q)+this.opt.labelOffset),C=g-this.opt.labelOffset);var I=Array(t.length);r.some(t,function(b,d){if(0>b)return!1;if(0==b)return this.dyn.push({fill:null,stroke:null}),!1;var n=y[d],
w=G[d],f;if(1<=b){f=this._plotFill(w.series.fill,h,c);f=this._shapeFill(f,{x:a.cx-a.r,y:a.cy-a.r,width:2*a.r,height:2*a.r});f=this._pseudoRadialFill(f,{x:a.cx,y:a.cy},a.r);var e=p.createCircle(a).setFill(f).setStroke(w.series.stroke);this.dyn.push({fill:f,stroke:w.series.stroke});F&&(n={element:"slice",index:d,run:this.run,shape:e,x:d,y:"number"==typeof n?n:n.y,cx:a.cx,cy:a.cy,cr:g},this._connectEvents(n),I[d]=n);return!1}var l=m+2*b*Math.PI;d+1==t.length&&(l=B+2*Math.PI);var e=l-m,k=a.cx+g*Math.cos(m),
x=a.cy+g*Math.sin(m),q=a.cx+g*Math.cos(l),r=a.cy+g*Math.sin(l);f=K._degToRad(this.opt.fanSize);if(w.series.fill&&"radial"===w.series.fill.type&&"fan"===this.opt.radGrad&&e>f){var u=p.createGroup(),v=Math.ceil(e/f),A=e/v;f=this._shapeFill(w.series.fill,{x:a.cx-a.r,y:a.cy-a.r,width:2*a.r,height:2*a.r});for(var s=0;s<v;++s){var z=0==s?k:a.cx+g*Math.cos(m+(s-0.2)*A),C=0==s?x:a.cy+g*Math.sin(m+(s-0.2)*A),D=s==v-1?q:a.cx+g*Math.cos(m+(s+1+0.2)*A),E=s==v-1?r:a.cy+g*Math.sin(m+(s+1+0.2)*A);u.createPath().moveTo(a.cx,
a.cy).lineTo(z,C).arcTo(g,g,0,A>Math.PI,!0,D,E).lineTo(a.cx,a.cy).closePath().setFill(this._pseudoRadialFill(f,{x:a.cx,y:a.cy},g,m+(s+0.5)*A,m+(s+0.5)*A))}u.createPath().moveTo(a.cx,a.cy).lineTo(k,x).arcTo(g,g,0,e>Math.PI,!0,q,r).lineTo(a.cx,a.cy).closePath().setStroke(w.series.stroke);e=u}else e=p.createPath().moveTo(a.cx,a.cy).lineTo(k,x).arcTo(g,g,0,e>Math.PI,!0,q,r).lineTo(a.cx,a.cy).closePath().setStroke(w.series.stroke),(f=w.series.fill)&&"radial"===f.type?(f=this._shapeFill(f,{x:a.cx-a.r,y:a.cy-
a.r,width:2*a.r,height:2*a.r}),"linear"===this.opt.radGrad&&(f=this._pseudoRadialFill(f,{x:a.cx,y:a.cy},g,m,l))):f&&"linear"===f.type&&(f=this._plotFill(f,h,c),f=this._shapeFill(f,e.getBoundingBox())),e.setFill(f);this.dyn.push({fill:f,stroke:w.series.stroke});F&&(n={element:"slice",index:d,run:this.run,shape:e,x:d,y:"number"==typeof n?n:n.y,cx:a.cx,cy:a.cy,cr:g},this._connectEvents(n),I[d]=n);m=l;return!1},this);if(this.opt.labels){var M=L("dojo-bidi")&&this.chart.isRightToLeft();if("default"==this.opt.labelStyle)m=
B,r.some(t,function(b,c){if(0>=b)return!1;var d=G[c];if(1<=b)return this.renderLabel(p,a.cx,a.cy+q/2,u[c],d,0<this.opt.labelOffset),!0;var e=m+2*b*Math.PI;c+1==t.length&&(e=B+2*Math.PI);if(this.opt.omitLabels&&0.001>e-m)return!1;var f=(m+e)/2,g=a.cx+C*Math.cos(f),f=a.cy+C*Math.sin(f)+q/2;this.renderLabel(p,M?h.width-g:g,f,u[c],d,0<this.opt.labelOffset);m=e;return!1},this);else if("columns"==this.opt.labelStyle){var m=B,E=this.opt.omitLabels,J=[];r.forEach(t,function(a,b){var c=m+2*a*Math.PI;b+1==
t.length&&(c=B+2*Math.PI);var d=(m+c)/2;J.push({angle:d,left:0>Math.cos(d),theme:G[b],index:b,omit:E?0.001>c-m:!1});m=c});d=v._base._getTextBox("a",{font:x}).h;this._getProperLabelRadius(J,d,1.1*a.r);r.forEach(J,function(b,c){if(!b.omit){var d=a.cx-2*a.r,e=a.cx+2*a.r,f=v._base._getTextBox(u[c],{font:b.theme.series.font}).w,g=a.cx+b.labelR*Math.cos(b.angle),l=a.cy+b.labelR*Math.sin(b.angle),e=b.left?d+f:e-f,d=b.left?d:e,m=p.createPath().moveTo(a.cx+a.r*Math.cos(b.angle),a.cy+a.r*Math.sin(b.angle));
Math.abs(b.labelR*Math.cos(b.angle))<2*a.r-f&&m.lineTo(g,l);m.lineTo(e,l).setStroke(b.theme.series.labelWiring);this.renderLabel(p,M?h.width-f-d:d,l,u[c],b.theme,!1,"left")}},this)}}var H=0;this._eventSeries[this.run.name]=k.map(y,function(a){return 0>=a?null:I[H++]});L("dojo-bidi")&&this._checkOrientation(this.group,h,c);return this},_getProperLabelRadius:function(h,c,p){var b,d,e=1,g=1;if(1==h.length)h[0].labelR=p;else{for(var k=0;k<h.length;k++){var q=Math.abs(Math.sin(h[k].angle));h[k].left?e>=
q&&(e=q,b=h[k]):g>=q&&(g=q,d=h[k])}b.labelR=d.labelR=p;this._calculateLabelR(b,h,c);this._calculateLabelR(d,h,c)}},_calculateLabelR:function(h,c,k){for(var b=h.index,d=c.length,e=h.labelR;!(c[b%d].left^c[(b+1)%d].left);)c[(b+1)%d].omit||(e=(Math.sin(c[b%d].angle)*e+(c[b%d].left?-k:k))/Math.sin(c[(b+1)%d].angle),e=e<h.labelR?h.labelR:e,c[(b+1)%d].labelR=e),b++;b=h.index;for(d=0==b?d-1:b-1;!(c[b].left^c[d].left);)c[d].omit||(e=(Math.sin(c[b].angle)*e+(c[b].left?k:-k))/Math.sin(c[d].angle),e=e<h.labelR?
h.labelR:e,c[d].labelR=e),b--,d--,b=0>b?b+c.length:b,d=0>d?d+c.length:d}})});
//@ sourceMappingURL=Pie.js.map