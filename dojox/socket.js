//>>built
define("dojox/socket",["dojo","dojo/on","dojo/Evented","dojo/cookie","dojo/_base/url"],function(c,n,p){function e(a){"string"==typeof a&&(a={url:a});return l?dojox.socket.WebSocket(a,!0):dojox.socket.LongPoll(a)}var l=window.WebSocket;dojox.socket=e;e.WebSocket=function(a,f){var b=new l(new c._Url(document.baseURI.replace(/^http/i,"ws"),a.url));b.on=function(a,c){b.addEventListener(a,c,!0)};var h;c.connect(b,"onopen",function(a){h=!0});c.connect(b,"onclose",function(c){h||f&&e.replace(b,dojox.socket.LongPoll(a),
!0)});return b};e.replace=function(a,f,b){function h(b){(f.addEventListener||f.on).call(f,b,function(b){n.emit(a,b.type,b)},!0)}a.send=c.hitch(f,"send");a.close=c.hitch(f,"close");b&&h("open");c.forEach(["message","close","error"],h)};e.LongPoll=function(a){function f(){0==d.readyState&&b("open",{});g.length||d.send()}function b(a,b,c){d["on"+a]&&(b.ioArgs=c&&c.ioArgs,b.type=a,n.emit(d,a,b))}var h=!1,e=!0,l,g=[],d={send:function(q){var m=c.delegate(a);m.rawBody=q;clearTimeout(l);var k=e?(e=!1)||d.firstRequest(m):
d.transport(m);g.push(k);k.then(function(e){d.readyState=1;g.splice(c.indexOf(g,k),1);g.length||(l=setTimeout(f,a.interval));e&&b("message",{data:e},k)},function(a){g.splice(c.indexOf(g,k),1);h||(b("error",{error:a},k),g.length||(d.readyState=3,b("close",{wasClean:!1},k)))});return k},close:function(){d.readyState=2;h=!0;for(var a=0;a<g.length;a++)g[a].cancel();d.readyState=3;b("close",{wasClean:!0})},transport:a.transport||c.xhrPost,args:a,url:a.url,readyState:0,CONNECTING:0,OPEN:1,CLOSING:2,CLOSED:3,
on:p.prototype.on,firstRequest:function(a){var b=a.headers||(a.headers={});b.Pragma="start-long-poll";try{return this.transport(a)}finally{delete b.Pragma}}};d.connect=d.on;setTimeout(f);return d};return e});
//@ sourceMappingURL=socket.js.map