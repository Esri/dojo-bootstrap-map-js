//>>built
define("dojox/geo/openlayers/Map","dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/dom dojo/dom-style ./_base ./TouchInteractionSupport ./Layer ./Patch".split(" "),function(m,n,t,l,p,q,u,g,r,k,s){m.experimental("dojox.geo.openlayers.Map");s.patchGFX();return n("dojox.geo.openlayers.Map",null,{olMap:null,_tp:null,constructor:function(a,b){b||(b={});a=q.byId(a);this._tp={x:0,y:0};var c=b.openLayersMapOptions;c||(c={controls:[new OpenLayers.Control.ScaleLine({maxWidth:200}),
new OpenLayers.Control.Navigation]});if(b.accessible){var d=new OpenLayers.Control.KeyboardDefaults;c.controls||(c.controls=[]);c.controls.push(d)}this.olMap=c=new OpenLayers.Map(a,c);this._layerDictionary={olLayers:[],layers:[]};b.touchHandler&&(this._touchControl=new r(c));c=this._createBaseLayer(b);this.addLayer(c);this.initialFit(b)},initialFit:function(a){(a=a.initialLocation)||(a=[-160,70,160,-70]);this.fitTo(a)},setBaseLayerType:function(a){if(a==this.baseLayerType)return null;var b=null;"string"==
typeof a?(b={baseLayerName:a,baseLayerType:a},this.baseLayerType=a):"object"==typeof a&&(b=a,this.baseLayerType=b.baseLayerType);a=null;if(null!=b&&(a=this._createBaseLayer(b),null!=a)){var b=this.olMap,c=b.getZoom(),d=b.getCenter(),e=!!d&&!!b.baseLayer&&!!b.baseLayer.map;if(e){var f=b.getProjectionObject();null!=f&&(d=d.transform(f,g.EPSG4326))}f=b.baseLayer;null!=f&&(f=this._getLayer(f),this.removeLayer(f));null!=a&&this.addLayer(a);e&&(f=b.getProjectionObject(),null!=f&&(d=d.transform(g.EPSG4326,
f)),b.setCenter(d,c))}return a},getBaseLayerType:function(){return this.baseLayerType},getScale:function(a){var b=null,b=this.olMap;if(a){if(!b.getUnits())return null;a=OpenLayers.INCHES_PER_UNIT;b=(b.getGeodesicPixelSize().w||1E-6)*a.km*OpenLayers.DOTS_PER_INCH}else b=b.getScale();return b},getOLMap:function(){return this.olMap},_createBaseLayer:function(a){var b=null,c=a.baseLayerType,d=a.baseLayerUrl,e=a.baseLayerName;a=a.baseLayerOptions;e||(e=c);a||(a={});switch(c){case g.BaseLayerType.OSM:a.transitionEffect=
"resize";b=new k(e,{olLayer:new OpenLayers.Layer.OSM(e,d,a)});break;case g.BaseLayerType.WMS:d||(d="http://labs.metacarta.com/wms/vmap0",a.layers||(a.layers="basic"));b=new k(e,{olLayer:new OpenLayers.Layer.WMS(e,d,a,{transitionEffect:"resize"})});break;case g.BaseLayerType.GOOGLE:b=new k(e,{olLayer:new OpenLayers.Layer.Google(e,a)});break;case g.BaseLayerType.VIRTUAL_EARTH:b=new k(e,{olLayer:new OpenLayers.Layer.VirtualEarth(e,a)});break;case g.BaseLayerType.YAHOO:b=new k(e,{olLayer:new OpenLayers.Layer.Yahoo(e,
a)});break;case g.BaseLayerType.ARCGIS:d||(d="http://server.arcgisonline.com/ArcGIS/rest/services/ESRI_StreetMap_World_2D/MapServer/export"),b=new k(e,{olLayer:new OpenLayers.Layer.ArcGIS93Rest(e,d,a,{})})}null==b&&(c instanceof OpenLayers.Layer?b=c:(a.transitionEffect="resize",b=new k(e,{olLayer:new OpenLayers.Layer.OSM(e,d,a)}),this.baseLayerType=g.BaseLayerType.OSM));return b},removeLayer:function(a){var b=this.olMap,c=l.indexOf(this._layerDictionary.layers,a);0<c&&this._layerDictionary.layers.splice(c,
1);a=a.olLayer;var d=l.indexOf(this._layerDictionary.olLayers,a);0<d&&this._layerDictionary.olLayers.splice(c,d);b.removeLayer(a,!1)},layerIndex:function(a,b){var c=this.olMap;if(!b)return c.getLayerIndex(a.olLayer);c.setLayerIndex(a.olLayer,b);this._layerDictionary.layers.sort(function(a,b){return c.getLayerIndex(a.olLayer)-c.getLayerIndex(b.olLayer)});this._layerDictionary.olLayers.sort(function(a,b){return c.getLayerIndex(a)-c.getLayerIndex(b)});return b},addLayer:function(a){a.dojoMap=this;var b=
this.olMap,c=a.olLayer;this._layerDictionary.olLayers.push(c);this._layerDictionary.layers.push(a);b.addLayer(c);a.added()},_getLayer:function(a){a=l.indexOf(this._layerDictionary.olLayers,a);return-1!=a?this._layerDictionary.layers[a]:null},getLayer:function(a,b){var c=this.olMap.getBy("layers",a,b),d=[];l.forEach(c,function(a){d.push(this._getLayer(a))},this);return d},getLayerCount:function(){var a=this.olMap;return null==a.layers?0:a.layers.length},fitTo:function(a){var b=this.olMap,c=g.EPSG4326;
if(null==a)a=this.transformXY(0,0,c),b.setCenter(new OpenLayers.LonLat(a.x,a.y));else{var d=null,e="string"==typeof a?p.fromJson(a):a,f;if(e.hasOwnProperty("bounds")){var h=e.bounds,d=new OpenLayers.Bounds;f=this.transformXY(h[0],h[1],c);d.left=f.x;d.top=f.y;f=this.transformXY(h[2],h[3],c);d.right=f.x;d.bottom=f.y}null==d&&e.hasOwnProperty("position")&&(h=e.position,e=e.hasOwnProperty("extent")?e.extent:1,"string"==typeof e&&(e=parseFloat(e)),d=new OpenLayers.Bounds,f=this.transformXY(h[0]-e,h[1]+
e,c),d.left=f.x,d.top=f.y,f=this.transformXY(h[0]+e,h[1]-e,c),d.right=f.x,d.bottom=f.y);null==d&&4==a.length&&(d=new OpenLayers.Bounds,f=this.transformXY(a[0],a[1],c),d.left=f.x,d.top=f.y,f=this.transformXY(a[2],a[3],c),d.right=f.x,d.bottom=f.y);null!=d&&b.zoomToExtent(d,!0)}},transform:function(a,b,c){return this.transformXY(a.x,a.y,b,c)},transformXY:function(a,b,c,d){var e=this._tp;e.x=a;e.y=b;c||(c=g.EPSG4326);d||(d=this.olMap.getProjectionObject());return e=OpenLayers.Projection.transform(e,c,
d)}})});
//@ sourceMappingURL=Map.js.map