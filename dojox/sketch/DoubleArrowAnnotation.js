//>>built
define("dojox/sketch/DoubleArrowAnnotation",["dojo/_base/kernel","dojo/_base/lang","./Annotation","./Anchor"],function(b){b.getObject("sketch",!0,dojox);var d=dojox.sketch;d.DoubleArrowAnnotation=function(a,c){d.Annotation.call(this,a,c);this.transform={dx:0,dy:0};this.start={x:0,y:0};this.control={x:100,y:-50};this.end={x:200,y:0};this.textPosition={x:0,y:0};this.textOffset=6;this.textYOffset=10;this.textAlign="middle";this.endRotation=this.startRotation=0;this.endArrowGroup=this.endArrow=this.startArrowGroup=
this.startArrow=this.pathShape=this.labelShape=null;this.anchors.start=new d.Anchor(this,"start");this.anchors.control=new d.Anchor(this,"control");this.anchors.end=new d.Anchor(this,"end")};d.DoubleArrowAnnotation.prototype=new d.Annotation;b=d.DoubleArrowAnnotation.prototype;b.constructor=d.DoubleArrowAnnotation;b.type=function(){return"DoubleArrow"};b.getType=function(){return d.DoubleArrowAnnotation};b._rot=function(){var a=this.control.y-this.start.y,c=this.control.x-this.start.x;this.startRotation=
Math.atan2(a,c);a=this.end.y-this.control.y;c=this.end.x-this.control.x;this.endRotation=Math.atan2(a,c)};b._pos=function(){var a=this.textOffset,a=this.control.y<this.end.y?-1*a:a+this.textYOffset,c=0.5*(this.control.x-this.start.x)+this.start.x,f=0.5*(this.control.y-this.start.y)+this.start.y;this.textPosition={x:0.5*(0.5*(this.end.x-this.control.x)+this.control.x-c)+c,y:0.5*(0.5*(this.end.y-this.control.y)+this.control.y-f)+f+a}};b.apply=function(a){if(a){a.documentElement&&(a=a.documentElement);
this.readCommonAttrs(a);for(var c=0;c<a.childNodes.length;c++){var f=a.childNodes[c];if("text"==f.localName)this.property("label",f.childNodes.length?f.childNodes[0].nodeValue:"");else if("path"==f.localName){var b=f.getAttribute("d").split(" "),e=b[0].split(",");this.start.x=parseFloat(e[0].substr(1),10);this.start.y=parseFloat(e[1],10);e=b[1].split(",");this.control.x=parseFloat(e[0].substr(1),10);this.control.y=parseFloat(e[1],10);e=b[2].split(",");this.end.x=parseFloat(e[0],10);this.end.y=parseFloat(e[1],
10);b=this.property("stroke");f=f.getAttribute("style");if(e=f.match(/stroke:([^;]+);/))b.color=e[1],this.property("fill",e[1]);if(e=f.match(/stroke-width:([^;]+);/))b.width=e[1];this.property("stroke",b)}}}};b.initialize=function(a){this.apply(a);this._rot();this._pos();var c=this.startRotation;a=dojox.gfx.matrix.rotate(c);c=this.endRotation;c=dojox.gfx.matrix.rotateAt(c,this.end.x,this.end.y);this.shape=this.figure.group.createGroup();this.shape.getEventSource().setAttribute("id",this.id);this.pathShape=
this.shape.createPath("M"+this.start.x+" "+this.start.y+"Q"+this.control.x+" "+this.control.y+" "+this.end.x+" "+this.end.y+" l0,0");this.startArrowGroup=this.shape.createGroup().setTransform({dx:this.start.x,dy:this.start.y});this.startArrowGroup.applyTransform(a);this.startArrow=this.startArrowGroup.createPath();this.endArrowGroup=this.shape.createGroup().setTransform(c);this.endArrow=this.endArrowGroup.createPath();this.labelShape=this.shape.createText({x:this.textPosition.x,y:this.textPosition.y,
text:this.property("label"),align:this.textAlign}).setFill(this.property("fill"));this.labelShape.getEventSource().setAttribute("id",this.id+"-labelShape");this.draw()};b.destroy=function(){this.shape&&(this.startArrowGroup.remove(this.startArrow),this.endArrowGroup.remove(this.endArrow),this.shape.remove(this.startArrowGroup),this.shape.remove(this.endArrowGroup),this.shape.remove(this.pathShape),this.shape.remove(this.labelShape),this.figure.group.remove(this.shape),this.shape=this.pathShape=this.labelShape=
this.startArrowGroup=this.startArrow=this.endArrowGroup=this.endArrow=null)};b.draw=function(a){this.apply(a);this._rot();this._pos();var c=this.startRotation;a=dojox.gfx.matrix.rotate(c);c=this.endRotation;c=dojox.gfx.matrix.rotateAt(c,this.end.x,this.end.y);this.shape.setTransform(this.transform);this.pathShape.setShape("M"+this.start.x+" "+this.start.y+" Q"+this.control.x+" "+this.control.y+" "+this.end.x+" "+this.end.y+" l0,0");this.startArrowGroup.setTransform({dx:this.start.x,dy:this.start.y}).applyTransform(a);
this.startArrow.setFill(this.property("fill"));this.endArrowGroup.setTransform(c);this.endArrow.setFill(this.property("fill"));this.labelShape.setShape({x:this.textPosition.x,y:this.textPosition.y,text:this.property("label")}).setFill(this.property("fill"));this.zoom()};b.zoom=function(a){if(this.startArrow){a=a||this.figure.zoomFactor;d.Annotation.prototype.zoom.call(this,a);var c=1<a?20:Math.floor(20/a),b=1<a?5:Math.floor(5/a);a=1<a?3:Math.floor(3/a);this.startArrow.setShape("M0,0 l"+c+",-"+b+" -"+
a+","+b+" "+a+","+b+" Z");this.endArrow.setShape("M"+this.end.x+","+this.end.y+" l-"+c+",-"+b+" "+a+","+b+" -"+a+","+b+" Z")}};b.getBBox=function(){var a=Math.min(this.start.x,this.control.x,this.end.x),c=Math.min(this.start.y,this.control.y,this.end.y),b=Math.max(this.start.x,this.control.x,this.end.x)-a,d=Math.max(this.start.y,this.control.y,this.end.y)-c;return{x:a,y:c,width:b,height:d}};b.serialize=function(){var a=this.property("stroke");return"\x3cg "+this.writeCommonAttrs()+'\x3e\x3cpath style\x3d"stroke:'+
a.color+";stroke-width:"+a.width+';fill:none;" d\x3d"M'+this.start.x+","+this.start.y+" Q"+this.control.x+","+this.control.y+" "+this.end.x+","+this.end.y+'" /\x3e\x3cg transform\x3d"translate('+this.start.x+","+this.start.y+") rotate("+Math.round(this.startRotation*(180/Math.PI)*Math.pow(10,4))/Math.pow(10,4)+')"\x3e\x3cpath style\x3d"fill:'+a.color+';" d\x3d"M0,0 l20,-5, -3,5, 3,5 Z" /\x3e\x3c/g\x3e\x3cg transform\x3d"rotate('+Math.round(this.endRotation*(180/Math.PI)*Math.pow(10,4))/Math.pow(10,
4)+", "+this.end.x+", "+this.end.y+')"\x3e\x3cpath style\x3d"fill:'+a.color+';" d\x3d"M'+this.end.x+","+this.end.y+' l-20,-5, 3,5, -3,5 Z" /\x3e\x3c/g\x3e\x3ctext style\x3d"fill:'+a.color+";text-anchor:"+this.textAlign+'" font-weight\x3d"bold" x\x3d"'+this.textPosition.x+'" y\x3d"'+this.textPosition.y+'"\x3e'+this.property("label")+"\x3c/text\x3e\x3c/g\x3e"};d.Annotation.register("DoubleArrow");return dojox.sketch.DoubleArrowAnnotation});
//@ sourceMappingURL=DoubleArrowAnnotation.js.map